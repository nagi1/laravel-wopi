<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<title data-react-helmet="true">Document Manager | Laravel-wopi Docs</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://nagi1.github.io/laravel-wopi/docs/getting-started/document-manager"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Document Manager | Laravel-wopi Docs"><meta data-react-helmet="true" name="description" content="Document Manager is the class (worker) and the glue between your application (Wopi Host) and the Wopi Client. It Also control the abilities for both users that currently editing the document and the document itself."><meta data-react-helmet="true" property="og:description" content="Document Manager is the class (worker) and the glue between your application (Wopi Host) and the Wopi Client. It Also control the abilities for both users that currently editing the document and the document itself."><link data-react-helmet="true" rel="shortcut icon" href="/laravel-wopi/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://nagi1.github.io/laravel-wopi/docs/getting-started/document-manager"><link data-react-helmet="true" rel="alternate" href="https://nagi1.github.io/laravel-wopi/docs/getting-started/document-manager" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://nagi1.github.io/laravel-wopi/docs/getting-started/document-manager" hreflang="x-default"><link rel="stylesheet" href="/laravel-wopi/assets/css/styles.932a6adb.css">
<link rel="preload" href="/laravel-wopi/assets/js/runtime~main.eebab166.js" as="script">
<link rel="preload" href="/laravel-wopi/assets/js/main.43844db4.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/laravel-wopi/"><b class="navbar__title">Laravel Wopi</b></a><a class="navbar__item navbar__link navbar__link--active" href="/laravel-wopi/docs">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/nagi1/laravel-wopi" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">🌜</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">🌞</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/laravel-wopi/docs">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Getting Started</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/laravel-wopi/docs/getting-started/installation">Installation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/laravel-wopi/docs/getting-started/configuration">Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/laravel-wopi/docs/getting-started/document-manager">Document Manager</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/laravel-wopi/docs/getting-started-with-wopi">Getting started with WOPI protocol</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Document Manager</h1></header><p>Document Manager is the class (<strong>worker</strong>) and the glue between your application <strong>(Wopi Host)</strong> and the <strong>Wopi Client</strong>. It Also control the abilities for both users that currently editing the document and the document itself.</p><p>The main player here is the <code>AbstractDocumentManager</code> class which implies by the name that it&#x27;s canned be called on constructed you need to implement your own document manager. This guid will help you with just that.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="implement-your-own-document-manager">Implement your own Document Manager<a aria-hidden="true" class="hash-link" href="#implement-your-own-document-manager" title="Direct link to heading">​</a></h2><p>Let&#x27;s set up a common scenario where your application stores files in the database and the actual documents (docx, pptx, xlsx) on the filesystem, Hence the name <code>DBDocumentManager</code>.</p><p>Extend <code>AbstractDocumentManager</code> and implement required methods.</p><p>You can also enable or disable features by implementing corespondant interface.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><pre tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">use Nagi\LaravelWopi\Contracts\AbstractDocumentManager;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class DBDocumentManager extends AbstractDocumentManager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ..implement abstract methods</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="example-document-manager-implementation">Example document manager implementation<a aria-hidden="true" class="hash-link" href="#example-document-manager-implementation" title="Direct link to heading">​</a></h2><p>Start implementing...</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><pre tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">use Nagi\LaravelWopi\Contracts\AbstractDocumentManager;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class DBDocumentManager extends AbstractDocumentManager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Not part of the interface</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected File $file;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // specific to this implementation and Not part of the interface</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function __construct(File $file)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $this-&gt;file = $file;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static function find(string $fileId): AbstractDocumentManager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $file =  File::findorFail($fileId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new static($file);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static function findByName(string $filename): AbstractDocumentManager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $file = File::whereName($filename)-&gt;firstOrFail();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new static($file);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static function create(array $properties): AbstractDocumentManager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $file = File::create([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;name&#x27; =&gt; $properties[&#x27;basename&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;size&#x27; =&gt; $properties[&#x27;size&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;path&#x27; =&gt; $properties[&#x27;basename&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;lock&#x27; =&gt; &#x27;&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;version&#x27; =&gt; &#x27;1&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;extension&#x27; =&gt; $properties[&#x27;extension&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;user_id&#x27; =&gt; 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        file_put_contents(Storage::disk(&#x27;public&#x27;)-&gt;path($properties[&#x27;basename&#x27;]), $properties[&#x27;content&#x27;]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new static($file);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Get file id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function id(): string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return $this-&gt;file-&gt;id;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Wopi client requires this!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function userFriendlyName(): string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $user = Auth::user();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return is_null($user) ? &#x27;Guest&#x27; : $user-&gt;name;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function basename(): string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return $this-&gt;file-&gt;name;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function owner(): string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return $this-&gt;file-&gt;user-&gt;id;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function size(): int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return $this-&gt;file-&gt;size;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function version(): string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return $this-&gt;file-&gt;version;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function content(): string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return file_get_contents(Storage::disk(&#x27;public&#x27;)-&gt;path($this-&gt;file-&gt;path));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function isLocked(): bool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return !empty($this-&gt;file-&gt;lock);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function getLock(): string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return $this-&gt;file-&gt;lock;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function put(string $content, array $editorsIds = []): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // calculate content size and hash, be carefull with large contents!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $size = strlen($content);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $hash = hash(&#x27;sha256&#x27;, base64_encode($content));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $newVersion = uniqid();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        file_put_contents(Storage::disk(&#x27;public&#x27;)-&gt;path($this-&gt;file-&gt;path), $content);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $this-&gt;file-&gt;fill([&#x27;size&#x27; =&gt; $size, &#x27;hash&#x27; =&gt; $hash, &#x27;version&#x27; =&gt; $newVersion])-&gt;update();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function deleteLock(): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $this-&gt;file-&gt;fill([&#x27;lock&#x27; =&gt; &#x27;&#x27;])-&gt;update();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function lock(string $lockId): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $this-&gt;file-&gt;fill([&#x27;lock&#x27; =&gt; $lockId])-&gt;update();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function delete(): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Storage::disk(&#x27;public&#x27;)-&gt;delete($this-&gt;file-&gt;path);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $this-&gt;file-&gt;delete();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>We chose not to use the contractor and save it for you to inject whatever you want, in this instance we used it to inject file model from the static constructors methods (<code>find</code>, <code>findByName</code>, <code>create</code>).</p><p>It&#x27;s relatively simple and straight forward to implement one of these and it&#x27;s highly dependable on your needs and usecase.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="enabling-features">Enabling Features<a aria-hidden="true" class="hash-link" href="#enabling-features" title="Direct link to heading">​</a></h2><p>Most of the wopi features encapsulated on separate interfaces, every feature have it&#x27;s set of rules and complications.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="available-features">Available Features<a aria-hidden="true" class="hash-link" href="#available-features" title="Direct link to heading">​</a></h2><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>Bellow every interface example of implementation not a package specific thing.</p></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="delete-document">Delete Document<a aria-hidden="true" class="hash-link" href="#delete-document" title="Direct link to heading">​</a></h3><p>Control ability to delete documents.</p><p>Implement <code>Deletable</code> interface</p><p>For example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><pre tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">use Nagi\LaravelWopi\Contracts\AbstractDocumentManager;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Nagi\LaravelWopi\Contracts\Concerns\Deletable;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class DBDocumentManager extends AbstractDocumentManager implements Deletable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Delete the document.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function delete(): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Storage::disk(&#x27;public&#x27;)-&gt;delete($this-&gt;file-&gt;path);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $this-&gt;file-&gt;delete();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // supportDelete() already implemented for you!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // see AbstractDocumentManager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="rename-document">Rename Document<a aria-hidden="true" class="hash-link" href="#rename-document" title="Direct link to heading">​</a></h3><p>Control ability to rename documents.</p><p>Implement <code>Renameable</code> interface</p><p>For example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><pre tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">use Nagi\LaravelWopi\Contracts\AbstractDocumentManager;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Nagi\LaravelWopi\Contracts\Concerns\Renameable;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class DBDocumentManager extends AbstractDocumentManager implements Renameable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function rename(string $newName): void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $oldPath = $this-&gt;file-&gt;path;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $this</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;fill([&#x27;name&#x27; =&gt; &quot;{$newName}.{$this-&gt;file-&gt;extension}&quot;, &#x27;path&#x27; =&gt; &quot;{$newName}.{$this-&gt;file-&gt;extension}&quot;])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            -&gt;update();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $newPath = $this-&gt;file-&gt;path;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Storage::disk(&#x27;public&#x27;)-&gt;move($oldPath, $newPath);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function canUserRename(): bool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // supportRename() already implemented for you!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="hash">Hash<a aria-hidden="true" class="hash-link" href="#hash" title="Direct link to heading">​</a></h3><p>Support hashes.</p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>Be extra carefull when calculating hashes for large contnet!</p></div></div><p>Implement <code>HasHash</code> interface</p><p>For example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><pre tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">use Nagi\LaravelWopi\Contracts\AbstractDocumentManager;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Nagi\LaravelWopi\Contracts\Concerns\HasHash;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class DBDocumentManager extends AbstractDocumentManager implements HasHash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * A 256 bit SHA-2-encoded hash of the file contents, as Base64-encoded</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * string. Used for caching purposes in WOPI clients. be careful when</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * calculating hashes for huge files that might impact performance.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @default-value not null empty string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function sha256Hash(): string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return $this-&gt;file-&gt;hash;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="metadata">Metadata<a aria-hidden="true" class="hash-link" href="#metadata" title="Direct link to heading">​</a></h3><p>Add support for extra metadata about the document.</p><p>Currently on one method is available.</p><p>Implement <code>HasMetadata</code> interface</p><p>For example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><pre tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">use Nagi\LaravelWopi\Contracts\AbstractDocumentManager;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Nagi\LaravelWopi\Contracts\Concerns\HasMetadata;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class DBDocumentManager extends AbstractDocumentManager implements HasMetadata</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * The last time that the file was modified. This time must always</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * be a must be a UTC time, and formatted in ISO-8601 roundtrip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * format. For example, &quot;2009-06-15T13:45:30.0000000Z&quot;.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @default-value not null empty string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function lastModifiedTime(): string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return Carbon::parse($this-&gt;file-&gt;updated_at, &#x27;UTC&#x27;)-&gt;toIso8601String();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="override-permissions">Override Permissions<a aria-hidden="true" class="hash-link" href="#override-permissions" title="Direct link to heading">​</a></h3><p>Control:</p><ul><li>wither document is in readonly mode.</li><li>permission to create new files on the server.</li></ul><p>Implement <code>OverridePermissions</code> interface</p><p>For example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><pre tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">use Nagi\LaravelWopi\Contracts\AbstractDocumentManager;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Nagi\LaravelWopi\Contracts\Concerns\OverridePermissions;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class DBDocumentManager extends AbstractDocumentManager implements OverridePermissions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Indicates that, for this user, the file cannot be changed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @default-value false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function isReadOnly(): bool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return auth()-&gt;user()-&gt;exceedEditingLimit();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Indicates the user does&#x27;t have permission to create new files on the</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * server. Setting this to true tells the WOPI client that calls to</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * PutRelativeFile will fail for this user on the current file.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @default-value false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function userCanNotWriteRelative(): bool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return auth()-&gt;user()-&gt;can(&#x27;create-new-file&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="sharing">Sharing<a aria-hidden="true" class="hash-link" href="#sharing" title="Direct link to heading">​</a></h3><p>Enable sharing documents via url like in google docs sharing functionality.</p><p>Implement <code>Shareable</code> interface</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><pre tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">use Nagi\LaravelWopi\Contracts\AbstractDocumentManager;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Nagi\LaravelWopi\Contracts\Concerns\Shareable;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class DBDocumentManager extends AbstractDocumentManager implements Shareable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * A URI to a location that allows the user to share the file.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @default-value not null empty string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function sharingUrl(): string;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * The Share URL types supported by the host. These types can</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * be passed in the X-WOPI-UrlType request header to signify</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * which Share URL type to return for the GetShareUrl.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @possible-value ReadOnly This type of Share URL allows</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * users to view the file using the URL, but does not</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * give them permission to edit the file.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @possible-value ReadWrite This type of Share URL allows</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * users to both view and edit the file using the URL.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @default-value empty array</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function supportedShareUrlTypes(): array;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="override-urls-proprties">Override Urls Proprties<a aria-hidden="true" class="hash-link" href="#override-urls-proprties" title="Direct link to heading">​</a></h3><p>Control:</p><ul><li>Override closing url.</li><li>Override download url.</li><li>Override get file version.</li></ul><p>Implement <code>HasUrlProprties</code> interface</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><pre tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">use Nagi\LaravelWopi\Contracts\AbstractDocumentManager;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Nagi\LaravelWopi\Contracts\Concerns\HasUrlProprties;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class DBDocumentManager extends AbstractDocumentManager implements HasUrlProprties</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * A URI to a web page that the WOPI client should</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * navigate to when the application closes, or</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * in the event of an unrecoverable error.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @default-value not null empty string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function closeUrl(): string;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * A user-accessible URI to the file that allows the user to</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * download a latest version of the file. This URI should</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * directly download the file. not direct to another UI.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @default-value not null empty string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function downloadUrl(): string;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * A URI to a location that allows the user to</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * view the version history for the file.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @default-value not null empty string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function getFileVersionUrl(): string;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="override-getfile-action-url">Override GetFile action url<a aria-hidden="true" class="hash-link" href="#override-getfile-action-url" title="Direct link to heading">​</a></h3><p>Override the url that WOPI clients will use to get the file.</p><p>Implement <code>OverrideGetFileContentUrlAction</code> interface</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><pre tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">use Nagi\LaravelWopi\Contracts\AbstractDocumentManager;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Nagi\LaravelWopi\Contracts\Concerns\OverrideGetFileContentUrlAction;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class DBDocumentManager extends AbstractDocumentManager implements OverrideGetFileContentUrlAction</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * A URI to the file location that the WOPI client uses to get the file.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * WOPI client may use this URI to get the file instead of a GetFile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * request. set this property if it provides better performance to</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * serve files from a different domain than current handling one.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @see https://docs.microsoft.com/en-us/microsoft-365/cloud-storage-partner-program/rest/files/checkfileinfo#fileurl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @default-value not null empty string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function getFileContentUrl(): string;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="override-get-file-extension">Override Get file extension<a aria-hidden="true" class="hash-link" href="#override-get-file-extension" title="Direct link to heading">​</a></h3><p>The name is pretty obvious 😂</p><p>Implement <code>StopRelayingOnBaseNameToGetFileExtension</code> interface</p><p>For example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><pre tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">use Nagi\LaravelWopi\Contracts\AbstractDocumentManager;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Nagi\LaravelWopi\Contracts\Concerns\StopRelayingOnBaseNameToGetFileExtension;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class DBDocumentManager extends AbstractDocumentManager implements StopRelayingOnBaseNameToGetFileExtension</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Get the file extension. This value must begin with a dot (.) If provided, WOPI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * clients will use this value as the file extension. Otherwise the extension</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * will be parsed from the BaseFileName. not required but recommended.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @default-value not null empty string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function extension(): string;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="enable-userinfo-functionality">Enable userInfo functionality<a aria-hidden="true" class="hash-link" href="#enable-userinfo-functionality" title="Direct link to heading">​</a></h3><p>Store/retrive basic information about the user form wopi client.</p><p>Implement <code>InteractsWithUserInfo</code> interface</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><pre tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">use Nagi\LaravelWopi\Contracts\AbstractDocumentManager;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Nagi\LaravelWopi\Contracts\Concerns\InteractsWithUserInfo;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class DBDocumentManager extends AbstractDocumentManager implements InteractsWithUserInfo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Store the string information about the user received from the wopi client.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static function putUserInfo(string $userInfo, ?string $fileId, ?string $accessToken): void;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * A string containing information about the user. WOPI clients can passed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * to the host by using PutUserInfo operation. If the host has a UserInfo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * string for the user, they must include it in this property.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function getUserInfo(): string;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Wither to enable or disable this functionality.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Note that in case enabled you&#x27;ll have to</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * implement putUserInfo and getUserInfo.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function supportUserInfo(): bool;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="disable-features-on-demand">Disable features on demand<a aria-hidden="true" class="hash-link" href="#disable-features-on-demand" title="Direct link to heading">​</a></h3><p>In some usecases you may want to disable one or multiple features for a certain user or document.</p><p>Implement one or more of the following interfaces:</p><ul><li><code>DisableCopy</code></li><li><code>DisableExport</code></li><li><code>DisablePrint</code></li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><pre tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">use Nagi\LaravelWopi\Contracts\AbstractDocumentManager;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Nagi\LaravelWopi\Contracts\Concerns\DisableExport;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Nagi\LaravelWopi\Contracts\Concerns\DisableCopy;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Nagi\LaravelWopi\Contracts\Concerns\DisablePrint;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class DBDocumentManager extends AbstractDocumentManager implements DisableExport, DisablePrint, DisableCopy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Disables copying from the document in wopi host online backend.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Pasting into the document would still be possible. However,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * it is still possible to do an “internal” cut/copy/paste.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function disableCopy(): bool;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Indicates the WOPI client should disable all export.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * functionality in WOPI host online backend. If</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * true, HideExportOption is assumed to be true.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function disableExport(): bool;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Hides Download as option in the file menubar.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function hideExportOption(): bool;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Indicates the WOPI client should disable all print.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * functionality in WOPI host online backend. If</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * true, HidePrintOption is assumed to be true.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function disablePrint(): bool;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * If set to true, hides the print option</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * from the file menu bar in the UI.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public function hidePrintOption(): bool;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="geturlforaction">getUrlForAction<a aria-hidden="true" class="hash-link" href="#geturlforaction" title="Direct link to heading">​</a></h2><p>One of the most important methods on the Document Manager, responsible for constructing the <code>urlsrc</code> for the action passed as well as override the default UI interface.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly php"><pre tabindex="0" class="prism-code language-php codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   $document = app(AbstractDocumentManager::class)::find(1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   return view(&#x27;test&#x27;, [&#x27;url&#x27; =&gt; $document-&gt;getUrlForAction(&#x27;edit&#x27;, &#x27;ar-SA&#x27;)]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="actions">Actions<a aria-hidden="true" class="hash-link" href="#actions" title="Direct link to heading">​</a></h3><p>Todo from the docs</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/nagi1/laravel-wopi/docs/getting-started/document-manager.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/laravel-wopi/docs/getting-started/configuration"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« <!-- -->Configuration</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/laravel-wopi/docs/getting-started-with-wopi"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Getting started with WOPI protocol<!-- --> »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#implement-your-own-document-manager" class="table-of-contents__link toc-highlight">Implement your own Document Manager</a></li><li><a href="#example-document-manager-implementation" class="table-of-contents__link toc-highlight">Example document manager implementation</a></li><li><a href="#enabling-features" class="table-of-contents__link toc-highlight">Enabling Features</a></li><li><a href="#available-features" class="table-of-contents__link toc-highlight">Available Features</a><ul><li><a href="#delete-document" class="table-of-contents__link toc-highlight">Delete Document</a></li><li><a href="#rename-document" class="table-of-contents__link toc-highlight">Rename Document</a></li><li><a href="#hash" class="table-of-contents__link toc-highlight">Hash</a></li><li><a href="#metadata" class="table-of-contents__link toc-highlight">Metadata</a></li><li><a href="#override-permissions" class="table-of-contents__link toc-highlight">Override Permissions</a></li><li><a href="#sharing" class="table-of-contents__link toc-highlight">Sharing</a></li><li><a href="#override-urls-proprties" class="table-of-contents__link toc-highlight">Override Urls Proprties</a></li><li><a href="#override-getfile-action-url" class="table-of-contents__link toc-highlight">Override GetFile action url</a></li><li><a href="#override-get-file-extension" class="table-of-contents__link toc-highlight">Override Get file extension</a></li><li><a href="#enable-userinfo-functionality" class="table-of-contents__link toc-highlight">Enable userInfo functionality</a></li><li><a href="#disable-features-on-demand" class="table-of-contents__link toc-highlight">Disable features on demand</a></li></ul></li><li><a href="#geturlforaction" class="table-of-contents__link toc-highlight">getUrlForAction</a><ul><li><a href="#actions" class="table-of-contents__link toc-highlight">Actions</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 Ahmed Nagi</div></div></div></footer></div>
<script src="/laravel-wopi/assets/js/runtime~main.eebab166.js"></script>
<script src="/laravel-wopi/assets/js/main.43844db4.js"></script>
</body>
</html>